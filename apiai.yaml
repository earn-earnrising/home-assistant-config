intents:
##############################################
# Heating intents
##############################################
  heating.check:
    speech: >
      {%- if is_state('switch.heating', 'on') -%}
        La calefacción está conectada, a una temperatura de {{ states('climate.termostato') }} grados.
        {% if is_state_attr('climate.termostato', 'operation_mode', 'idle') %}
          No está en marcha 
        {% else %}
          Está en marcha 
        {%- endif -%}
        {% if is_state('switch.thermostat_away_mode', 'on') %}
          y tiene el modo ausente activado.
        {% else %}
          y tiene el modo ausente desactivado.
        {%- endif -%}
      {%- else -%}
         La calefacción está desconectada
      {%- endif -%}

  heating.turn:
    speech: >
      {%- if OnOff == 'on' -%}
        ¡Hecho! calefacción encendida
      {%- else -%}
        Es un placer, calefacción apagada
      {%- endif -%}
    async_action: false
    action:
      - service_template: 'switch.turn_{{ OnOff }}'
        entity_id: 'switch.heating'

  heating.temperature:
    speech: 'Cambiando temperatura de la calefacción a {{ temperature }} grados' 
    async_action: false
    action:
      - service: climate.set_temperature
        data_template:
          entity_id: climate.termostato
          temperature: '{{ temperature }}'

  heating.away_mode: 
    speech: >
      {% if device is undefined and function is undefined %}
        {{ states("sensor.apiai_heating_away_mode_switch_onoff_" ~ OnOff) }}
      {% elif device is undefined %}
       ¡Hecho! He {{ states("sensor.apiai_heating_away_mode_switch_onoff_" ~ OnOff) }} el {{ states("sensor.apiai_heating_away_mode_switch_" ~ function) }}
      {% else %}
        ¡Hecho! He {{ states("sensor.apiai_heating_away_mode_switch_onoff_" ~ OnOff) }} el {{ states("sensor.apiai_heating_away_mode_switch_" ~ function) }} en {{ states("sensor.apiai_heating_away_mode_switch_" ~ device) }}'
      {%- endif -%}
    async_action: false
    action:
      - service_template: 'switch.turn_{{ OnOff }}'
        data_template:
          entity_id: 'switch.heating_away_mode'

##############################################
# Temperature intents
##############################################
  temperature.check:
    speech: > 
      {%- if location == 'el exterior' or location == 'la piscina' or location == 'la caseta' -%}
        La temperatura en {{ location }} es de {{ states("sensor.netatmo_exterior_temperature") }} grados, con una humedad del {{ states("sensor.netatmo_exterior_humidity") }} por ciento y unas rachas de viento de {{ states("sensor.netatmo_anemometro_gust_strength") }} kilómetros por hora
      {%- elif location == 'el salon' or location == 'la suite' -%}
        {% set locationPre,locationName = location.split(' ') %}
        La temperatura en {{ location | replace("o", "ó") }} es de {{ states("sensor.netatmo_" ~ locationName ~ "_temperature") }} grados, con una humedad del {{ states("sensor.netatmo_" ~ locationName ~ "_humidity") }} por ciento
      {%- elif estancia == 'el recibidor' -%}
        La temperatura en {{ location }} es de {{ states.climate.termostato.attributes.current_temperature }} grados
      {%- else -%}
        No tengo sensor de temperatura en {{ location }}
      {% endif %}

##############################################
# Light intents
##############################################
  light.check:
    speech: >

##############################################
# Various intents
##############################################
  shift.geni.check:
    speech: >
       {%- if is_state('sensor.next_shift_event', 'Saliente') -%}
         Geni está hoy saliente de noche
       {%- else -%}
         {% set diff = as_timestamp(states.calendar.turnos_geni_everything.attributes.start_time) - as_timestamp(now().replace(hour=0).replace(minute=0).replace(second=0).replace(microsecond=0)) %}
         {%- if diff < 86400 -%}
           Geni trabaja hoy por la {{ states('sensor.next_shift_event') }}
         {%- elif diff >= 86400 and diff < 86400*2 -%}
           Geni trabaja mañana por la {{ states('sensor.next_shift_event') }}
         {%- else -%}
           Geni trabaja el próximo {{ states('sensor.next_shift_date') }} por la {{ states('sensor.next_shift_event') }}
         {% endif %}
       {% endif %}

  presence.geni.check:
    speech: >
      {%- if is_state('device_tracker.geni_combined', 'home') -%}
        Si, parece que Geni está en casa.
      {%- else -%}
        Pues parece que Geni no está en casa.
      {%- endif -%}

  goodnight.check:
    speech: >
      'Buenas nochessss'
