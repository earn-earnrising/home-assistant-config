homeassistant:
  customize:
    ###################################
    # Hall camera customization
    ###################################
    camera.recibidor:
      friendly_name: 'Recibidor'
    binary_sensor.recibidor_camara_infrarrojo:
      friendly_name: 'Infrarrojos recibidor'
      icon: 'mdi:led-on'
    binary_sensor.recibidor_camara_det_mov:
      friendly_name: 'Movimiento recibidor'
    switch.recibidor_camara_det_mov:
      friendly_name: 'Det. mov. recibidor'
      icon: 'mdi:transit-transfer'

    ###################################
    # Living room camera customization
    ###################################
    camera.salon:
      friendly_name: 'Salón'
    binary_sensor.salon_camara_infrarrojo:
      friendly_name: 'Infrarrojos salón'
      icon: 'mdi:led-on'
    binary_sensor.salon_camara_det_mov:
      friendly_name: 'Movimiento salón'
    switch.salon_camara_det_mov:
      friendly_name: 'Det. mov. salón'
      icon: 'mdi:transit-transfer'

    ###################################
    # Swimming pool camera customization
    ###################################
    camera.piscina:
      friendly_name: 'Piscina'
    binary_sensor.piscina_camara_infrarrojo:
      friendly_name: 'Infrarrojos piscina'
      icon: 'mdi:led-on'
    binary_sensor.piscina_camara_det_mov:
      friendly_name: 'Movimiento piscina'
    switch.piscina_camara_det_mov:
      friendly_name: 'Det. mov. piscina'
      icon: 'mdi:transit-transfer'

    ###################################
    # BBQ camera customization
    ###################################
    camera.barbacoa:
      friendly_name: 'Barbacoa'
    binary_sensor.barbacoa_camara_infrarrojo:
      friendly_name: 'Infrarrojos barbacoa'
      icon: 'mdi:led-on'
    binary_sensor.barbacoa_camara_det_mov:
      friendly_name: 'Movimiento barbacoa'
    switch.barbacoa_camara_det_mov:
      friendly_name: 'Det. mov. barbacoa'
      icon: 'mdi:transit-transfer'

    ###################################
    # Shed camera customization
    ###################################
    camera.caseta:
      friendly_name: 'Caseta'
    binary_sensor.caseta_camara_det_mov:
      friendly_name: 'Movimiento caseta'
    switch.caseta_camara_det_mov:
      friendly_name: 'Det. mov. caseta'
      icon: 'mdi:transit-transfer'

    ###################################
    # Main entrance camera customization
    ###################################
    binary_sensor.entrada_principal_outdoor_motion:
      friendly_name: 'Movimiento desconocido'
    binary_sensor.entrada_principal_outdoor_human:
      friendly_name: 'Persona detectada'
    binary_sensor.entrada_principal_outdoor_animal:
      friendly_name: 'Animal detectado'
      icon: 'mdi:paw'
    binary_sensor.entrada_principal_outdoor_vehicle:
      friendly_name: 'Vehiculo detectado'
      icon: 'mdi:car'

    ###################################
    # Office motion sensor customization
    ###################################
    binary_sensor.despacho_sensor_movimiento:
      friendly_name: 'Movimiento despacho'
      device_class: 'motion'
    binary_sensor.despacho_sensor_movimiento_sabotaje:
      friendly_name: 'Manipulación sensor'
    sensor.despacho_sensor_movimiento_luminance:
      icon: 'mdi:weather-sunny'
      friendly_name: 'Luminosidad'
    sensor.despacho_sensor_movimiento_bateria:
      device_class: 'battery'
      friendly_name: 'Detector movimiento despacho'
    sensor.despacho_sensor_movimiento_temperature:
      friendly_name: 'Temperatura'

    ###################################
    # Porch door sensor customization
    ###################################
    binary_sensor.porche_sensor_puerta:
      device_class: 'door'
      friendly_name: 'Puerta porche'
    sensor.porche_sensor_puerta:
    #  icon: 'mdi:glassdoor'
      friendly_name: 'Estado puerta porche'
    sensor.porche_sensor_puerta_bateria:
      device_class: 'battery'
      friendly_name: 'Sensor puerta cocina'
    sensor.porche_sensor_puerta_temperature:
      friendly_name: 'Temperatura'
      icon: mdi:thermometer

    ###################################
    # Porch blind door sensor customization
    ###################################
    binary_sensor.porche_sensor_persiana:
      device_class: 'door'
      friendly_name: 'Persiana porche'
    sensor.porche_sensor_persiana:
    #  icon: 'mdi:glassdoor'
      friendly_name: 'Estado persiana porche'
    sensor.porche_sensor_persiana_bateria:
      device_class: 'battery'
      friendly_name: 'Sensor persiana cocina'

    ###################################
    # Laundry door sensor customization
    ###################################
    binary_sensor.coladuria_sensor_puerta:
      device_class: 'door'
      friendly_name: 'Puerta coladuría'
    sensor.coladuria_sensor_puerta:
    #  icon: 'mdi:glassdoor'
      friendly_name: 'Estado puerta coladuria'
    sensor.coladuria_sensor_puerta_bateria:
      device_class: 'battery'
      friendly_name: 'Sensor puerta coladuria'

folder_watcher:
  - folder: /home/camera
    patterns:
      - '*.jpg'
      - '*.mp4'
      - '*.mkv'

recorder:
  exclude:
    entities:
      - sensor.porche_sensor_puerta_access_control
      - sensor.porche_sensor_puerta_alarm_level
      - sensor.porche_sensor_puerta_alarm_type
      - sensor.porche_sensor_puerta_burglar
      - sensor.porche_sensor_puerta_general
      - sensor.porche_sensor_puerta_sourcenodeid
      - sensor.porche_sensor_puerta_system
      - sensor.porche_sensor_puerta_heat
      - sensor.porche_sensor_puerta
      - binary_sensor.porche_sensor_puerta

      - sensor.porche_sensor_persiana_access_control
      - sensor.porche_sensor_persiana_alarm_level
      - sensor.porche_sensor_persiana_alarm_type
      - sensor.porche_sensor_persiana_burglar
      - sensor.porche_sensor_persiana_general
      - sensor.porche_sensor_persiana_sourcenodeid
      - sensor.porche_sensor_persiana
      - binary_sensor.porche_sensor_persiana

      - sensor.coladuria_sensor_puerta_access_control
      - sensor.coladuria_sensor_puerta_alarm_level
      - sensor.coladuria_sensor_puerta_alarm_type
      - sensor.coladuria_sensor_puerta_burglar
      - sensor.coladuria_sensor_puerta_general
      - sensor.coladuria_sensor_puerta_sourcenodeid
      - sensor.coladuria_sensor_puerta
      - binary_sensor.coladuria_sensor_puerta

      - sensor.despacho_sensor_movimiento_alarm_level
      - sensor.despacho_sensor_movimiento_alarm_type
      - sensor.despacho_sensor_movimiento_burglar
      - sensor.despacho_sensor_movimiento_general
      - sensor.despacho_sensor_movimiento_seismic_intensity
      - sensor.despacho_sensor_movimiento_sourcenodeid
#      - binary_sensor.despacho_sensor_movimiento

group:
  Seguridad:
    entities:
      - switch.recibidor_camara_det_mov
      - switch.salon_camara_det_mov
      - switch.piscina_camara_det_mov
      - switch.barbacoa_camara_det_mov
      - switch.caseta_camara_det_mov
      - input_boolean.entrada_principal_camara_det_mov
      - input_boolean.despacho_sensor_movimiento
      - input_boolean.porche_sensor_puerta
      - input_boolean.porche_sensor_persiana
      - input_boolean.coladuria_sensor_puerta

  Cámara recibidor:
    entities:
      - camera.recibidor
      - switch.recibidor_camara_det_mov
      - binary_sensor.recibidor_camara_infrarrojo
      - binary_sensor.recibidor_camara_det_mov

  Cámara salón:
    entities:
      - camera.salon
      - switch.salon_camara_det_mov
      - binary_sensor.salon_camara_infrarrojo
      - binary_sensor.salon_camara_det_mov

  Cámara barbacoa:
    entities:
      - camera.barbacoa
      - switch.barbacoa_camara_det_mov
      - binary_sensor.barbacoa_camara_infrarrojo
      - binary_sensor.barbacoa_camara_det_mov
  
  Cámara piscina:
    entities:
      - camera.piscina
      - switch.piscina_camara_det_mov
      - binary_sensor.piscina_camara_infrarrojo
      - binary_sensor.piscina_camara_det_mov
  
  Cámara caseta:
    entities:
      - camera.caseta
      - switch.caseta_camara_det_mov
      - binary_sensor.caseta_camara_det_mov
  
  Cámara entrada principal:
    entities:
      - camera.entrada_principal
      - input_boolean.entrada_principal_camara_det_mov
      - binary_sensor.entrada_principal_outdoor_motion
      - binary_sensor.entrada_principal_outdoor_human
      - binary_sensor.entrada_principal_outdoor_animal
      - binary_sensor.entrada_principal_outdoor_vehicle
  
  Seguridad interior:
    entities:
      - switch.recibidor_camara_det_mov
      - switch.salon_camara_det_mov
      - input_boolean.despacho_sensor_movimiento
      - input_boolean.cocina_sensor_puerta
      - input_boolean.coladuria_sensor_puerta
  
  Seguridad exterior:
    entities:
      - switch.piscina_camara_det_mov
      - switch.barbacoa_camara_det_mov
      - switch.caseta_camara_det_mov
      - input_boolean.entrada_principal_camara_det_mov
      - input_boolean.cocina_sensor_persiana
  
  Sensor despacho:
    entities:
      - binary_sensor.despacho_sensor_movimiento
      - binary_sensor.despacho_sensor_movimiento_sabotaje
#      - sensor.despacho_sensor_movimiento_bateria
      - input_boolean.despacho_sensor_movimiento
  
  Puerta porche cocina:
    entities:
      - binary_sensor.porche_sensor_puerta
      - input_boolean.porche_sensor_puerta
  
  Persiana porche cocina:
    entities:
      - binary_sensor.porche_sensor_persiana
      - input_boolean.porche_sensor_persiana
  
  Puerta coladuria cocina:
    entities:
      - binary_sensor.coladuria_sensor_puerta
      - input_boolean.coladuria_sensor_puerta

switch:
  - platform: command_line
    switches:
      #Switch for Foscam Motion Detection
      recibidor_camara_det_mov:
        # Command used:
        # 'curl -k "https://<camera_host>:<camera_port>/cgi-bin/CGIProxy.fcgi?cmd=setMotionDetectConfig&isEnable=1&linkage=12&snapInterval=3&sensitivity=1&triggerInterval=10&isMovAlarmEnable=1&isPirAlarmEnable=1&schedule0=281474976710655&schedule1=281474976710655&schedule2=281474976710655&schedule3=281474976710655&schedule4=281474976710655&schedule5=281474976710655&schedule6=281474976710655&area0=1023&area1=1023&area2=1023&area3=1023&area4=1023&area5=1023&area6=1023&area7=1023&area8=1023&area9=1023&usr=<camera_username>&pwd=<camera_password>"'
        command_on: !secret cam_recibidor_motion_detection_on
        # Command used:
        # 'curl -k "https://<camera_host>:<camera_port>/cgi-bin/CGIProxy.fcgi?cmd=setMotionDetectConfig&isEnable=0&linkage=12&snapInterval=3&sensitivity=1&triggerInterval=10&isMovAlarmEnable=1&isPirAlarmEnable=1&schedule0=281474976710655&schedule1=281474976710655&schedule2=281474976710655&schedule3=281474976710655&schedule4=281474976710655&schedule5=281474976710655&schedule6=281474976710655&area0=1023&area1=1023&area2=1023&area3=1023&area4=1023&area5=1023&area6=1023&area7=1023&area8=1023&area9=1023&usr=<camera_username>&pwd=<camera_password>"'
        command_off: !secret cam_recibidor_motion_detection_off
        # Command used:
        # 'curl -k --silent "https://<camera_host>:<camera_port>/cgi-bin/CGIProxy.fcgi?cmd=getMotionDetectConfig&usr=<camera_username>&pwd=<camera_password>" | grep -oP "(?<=isEnable>).*?(?=</isEnable>)"'
        command_state: !secret cam_recibidor_motion_detection_state
        value_template: '{{ value == "1" }}'
  
  - platform: command_line
    switches:
      #Switch for Foscam Motion Detection
      piscina_camara_det_mov:
        # Command used:
        # 'curl -k "https://<camera_host>:<camera_port>/cgi-bin/CGIProxy.fcgi?cmd=setMotionDetectConfig&isEnable=1&linkage=12&snapInterval=3&sensitivity=1&triggerInterval=10&isMovAlarmEnable=1&isPirAlarmEnable=1&schedule0=281474976710655&schedule1=281474976710655&schedule2=281474976710655&schedule3=281474976710655&schedule4=281474976710655&schedule5=281474976710655&schedule6=281474976710655&area0=1023&area1=1023&area2=1023&area3=1023&area4=1009&area5=992&area6=992&area7=1023&area8=1023&area9=1023&usr=<camera_username>&pwd=<camera_password>"'
        command_on: !secret cam_piscina_motion_detection_on
        # Command used:
        # 'curl -k "https://<camera_host>:<camera_port>/cgi-bin/CGIProxy.fcgi?cmd=setMotionDetectConfig&isEnable=0&linkage=12&snapInterval=3&sensitivity=1&triggerInterval=10&isMovAlarmEnable=1&isPirAlarmEnable=1&schedule0=281474976710655&schedule1=281474976710655&schedule2=281474976710655&schedule3=281474976710655&schedule4=281474976710655&schedule5=281474976710655&schedule6=281474976710655&area0=1023&area1=1023&area2=1023&area3=1023&area4=1009&area5=992&area6=992&area7=1023&area8=1023&area9=1023&usr=<camera_username>&pwd=<camera_password>"'
        command_off: !secret cam_piscina_motion_detection_off
        # Command used:
        # 'curl -k --silent "https://<camera_host>:<camera_port>/cgi-bin/CGIProxy.fcgi?cmd=getMotionDetectConfig&usr=<camera_username>&pwd=<camera_password>" | grep -oP "(?<=isEnable>).*?(?=</isEnable>)"'
        command_state: !secret cam_piscina_motion_detection_state
        value_template: '{{ value == "1" }}'
  
  - platform: command_line
    switches:
      #Switch for Foscam Motion Detection
      barbacoa_camara_det_mov:
        # Command used:
        # 'curl -k "https://<camera_host>:<camera_port>/cgi-bin/CGIProxy.fcgi?cmd=setMotionDetectConfig1&isEnable=1&linkage=4&snapInterval=5&triggerInterval=5&isMovAlarmEnable=1&isPirAlarmEnable=1&schedule0=281474976710655&schedule1=281474976710655&schedule2=281474976710655&schedule3=281474976710655&schedule4=281474976710655&schedule5=281474976710655&schedule6=281474976710655&x1=0&y1=0&width1=10000&height1=10000&threshold1=50&sensitivity1=0&valid1=1&x2=0&y2=0&width2=0&height2=0&threshold2=50&sensitivity2=0&valid2=0&x3=0&y3=0&width3=0&height3=0&threshold3=50&sensitivity3=0&valid3=0&usr=<camera_username>&pwd=<camera_password>"'
        command_on: !secret cam_barbacoa_motion_detection_on
        # Command used:
        # 'curl -k "https://<camera_host>:<camera_port>/cgi-bin/CGIProxy.fcgi?cmd=setMotionDetectConfig1&isEnable=0&linkage=4&snapInterval=5&triggerInterval=5&isMovAlarmEnable=1&isPirAlarmEnable=1&schedule0=281474976710655&schedule1=281474976710655&schedule2=281474976710655&schedule3=281474976710655&schedule4=281474976710655&schedule5=281474976710655&schedule6=281474976710655&x1=0&y1=0&width1=10000&height1=10000&threshold1=50&sensitivity1=0&valid1=1&x2=0&y2=0&width2=0&height2=0&threshold2=50&sensitivity2=0&valid2=0&x3=0&y3=0&width3=0&height3=0&threshold3=50&sensitivity3=0&valid3=0&usr=<camera_username>&pwd=<camera_password>"'
        command_off: !secret cam_barbacoa_motion_detection_off
        # Command used:
        # 'curl -k --silent "https://<camera_host>:<camera_port>/cgi-bin/CGIProxy.fcgi?cmd=getMotionDetectConfig1&usr=<camera_username>&pwd=<camera_password>" | grep -oP "(?<=isEnable>).*?(?=</isEnable>)"'
        command_state: !secret cam_barbacoa_motion_detection_state
        value_template: '{{ value == "1" }}'
  
  - platform: command_line
    switches:
      #Switch for Foscam Motion Detection
      salon_camara_det_mov:
        # Command used:
        # 'curl -k "https://<camera_host>:<camera_port>/cgi-bin/CGIProxy.fcgi?cmd=setMotionDetectConfig&isEnable=1&linkage=12&snapInterval=3&sensitivity=1&triggerInterval=10&isMovAlarmEnable=1&isPirAlarmEnable=1&schedule0=281474976710655&schedule1=281474976710655&schedule2=281474976710655&schedule3=281474976710655&schedule4=281474976710655&schedule5=281474976710655&schedule6=281474976710655&area0=1023&area1=1023&area2=1023&area3=1023&area4=1023&area5=1023&area6=1023&area7=1023&area8=1023&area9=1023&usr=<camera_username>&pwd=<camera_password>"'
        command_on: !secret cam_salon_motion_detection_on
        # Command used:
        # 'curl -k "https://<camera_host>:<camera_port>/cgi-bin/CGIProxy.fcgi?cmd=setMotionDetectConfig&isEnable=0&linkage=12&snapInterval=3&sensitivity=1&triggerInterval=10&isMovAlarmEnable=1&isPirAlarmEnable=1&schedule0=281474976710655&schedule1=281474976710655&schedule2=281474976710655&schedule3=281474976710655&schedule4=281474976710655&schedule5=281474976710655&schedule6=281474976710655&area0=1023&area1=1023&area2=1023&area3=1023&area4=1023&area5=1023&area6=1023&area7=1023&area8=1023&area9=1023&usr=<camera_username>&pwd=<camera_password>"'
        command_off: !secret cam_salon_motion_detection_off
        # Command used:
        # 'curl -k --silent "https://<camera_host>:<camera_port>/cgi-bin/CGIProxy.fcgi?cmd=getMotionDetectConfig&usr=<camera_username>&pwd=<camera_password>" | grep -oP "(?<=isEnable>).*?(?=</isEnable>)"'
        command_state: !secret cam_salon_motion_detection_state
        value_template: '{{ value == "1" }}'
  
  - platform: command_line
    switches:
      #Switch for Linksys WVC54GCA Motion Detection
      caseta_camara_det_mov:
        # Command used:
        # 'curl --user <camera_username>:<camera_password> -k "http://<camera_host>:<camera_port>/adm/file.cgi?h_en_trig=1&todo=save"'
        command_on: !secret cam_caseta_motion_detection_on
        # Command used:
        # 'curl --user <camera_username>:<camera_password> -k "http://<camera_host>:<camera_port>/adm/file.cgi?h_en_trig=0&todo=save"'
        command_off: !secret cam_caseta_motion_detection_off
        # Command used:
        # 'curl --user <camera_username>:<camera_password> -k --silent "http://<camera_host>:<camera_port>/adm/file.cgi?next_file=event.htm" | grep -oP "(?<=<input type=\"Hidden\" name=\"h_en_trig\" value=\").*?(?=\">)"'
        command_state: !secret cam_caseta_motion_detection_state
        value_template: '{{ value == "1" }}'

input_boolean:
  porche_sensor_puerta:
    name: Det. apert. puerta porche
    icon: 'mdi:glassdoor'
  
  porche_sensor_persiana:
    name: Det. apert. persiana porche
    icon: 'mdi:glassdoor'
  
  coladuria_sensor_puerta:
    name: Det. apert. puerta coladuría
    icon: 'mdi:glassdoor'
  
  despacho_sensor_movimiento:
    name: Det. mov. despacho
    icon: 'mdi:transit-transfer'
  
  entrada_principal_camara_det_mov:
    name: Det. mov. entrada ppal.
    icon: 'mdi:transit-transfer'

camera:
  # Hall camera
  - platform: foscam
    ip: !secret cam_recibidor_host
    name: recibidor
    port: !secret cam_recibidor_port
    username: !secret cam_recibidor_username
    password: !secret cam_recibidor_password
  
   # Swiming pool camera
  - platform: foscam
    ip: !secret cam_piscina_host
    name: piscina
    port: !secret cam_piscina_port
    username: !secret cam_piscina_username
    password: !secret cam_piscina_password
  
   # Bbq camera
  - platform: foscam
    ip: !secret cam_barbacoa_host
    name: barbacoa
    port: !secret cam_barbacoa_port
    username: !secret cam_barbacoa_username
    password: !secret cam_barbacoa_password
  
  # Backyard stand camera
  - platform: foscam
    ip: !secret cam_salon_host
    name: salon
    port: !secret cam_salon_port
    username: !secret cam_salon_username
    password: !secret cam_salon_password

  # For Linksys WVC54GCA http://<cam-host>:<cam_port>/img/snapshot.cgi
  - platform: generic
    still_image_url: !secret cam_caseta_still_image_url
    name: caseta
    username: !secret cam_caseta_username
    password: !secret cam_caseta_password
    authentication: basic

binary_sensor:
  # Infrared status for foscam cam in hall
  - platform: command_line
    # Command used to get infrared status for a foscam camera:
    # 'curl -k --silent "https://<cam_host>:<cam_port>/cgi-bin/cgi-bin/CGIProxy.fcgi?cmd=getDevState&usr=<username>&pwd=<password>" | grep -oP "(?<=infraLedState>).*?(?=</infraLedState>)"'
    command: !secret cam_recibidor_infrared_command
    name: recibidor_camara_infrarrojo
    payload_on: '1'
    payload_off: '0'
    #device_class: light
  
  # Infrared status for foscam cam in swimming pool
  - platform: command_line
    # Command used to get infrared status for a foscam camera:
    # 'curl -k --silent "https://<cam_host>:<cam_port>/cgi-bin/cgi-bin/CGIProxy.fcgi?cmd=getDevState&usr=<username>&pwd=<password>" | grep -oP "(?<=infraLedState>).*?(?=</infraLedState>)"'
    command: !secret cam_piscina_infrared_command
    name: piscina_camara_infrarrojo
    payload_on: '1'
    payload_off: '0'
    #device_class: light
  
  # Infrared status for foscam cam in bbq
  - platform: command_line
    # Command used to get infrared status for a foscam camera:
    # 'curl -k --silent "https://<cam_host>:<cam_port>/cgi-bin/cgi-bin/CGIProxy.fcgi?cmd=getDevState&usr=<username>&pwd=<password>" | grep -oP "(?<=infraLedState>).*?(?=</infraLedState>)"'
    command: !secret cam_barbacoa_infrared_command
    name: barbacoa_camara_infrarrojo
    payload_on: '1'
    payload_off: '0'
    #device_class: light
  
  # Infrared status for foscam cam in 
  - platform: command_line
    # Command used to get infrared status for a foscam camera:
    # 'curl -k --silent "https://<cam_host>:<cam_port>/cgi-bin/cgi-bin/CGIProxy.fcgi?cmd=getDevState&usr=<username>&pwd=<password>" | grep -oP "(?<=infraLedState>).*?(?=</infraLedState>)"'
    command: !secret cam_salon_infrared_command
    name: salon_camara_infrarrojo
    payload_on: '1'
    payload_off: '0'
    #device_class: light
  
  # Alarm status for foscam cam in hall
  - platform: mqtt
    state_topic: 'home/camera/recibidor/alarm'
    name: recibidor_camara_det_mov
    device_class: motion
    # 0: No alarm
    # 1: Alarm triggered
    value_template: >-
            {%- if value != "0" %}
                ON
            {% else %}
                OFF
            {%- endif %}
  
  # Alarm status for foscam cam in swimming pool
  - platform: mqtt
    state_topic: 'home/camera/piscina/alarm'
    name: piscina_camara_det_mov
    device_class: motion
    # 0: No alarm
    # 1: Alarm triggered
    value_template: >-
            {%- if value != "0" %}
                ON
            {% else %}
                OFF
            {%- endif %}
  
  # Alarm status for foscam cam in bbq
  - platform: mqtt
    state_topic: 'home/camera/barbacoa/alarm'
    name: barbacoa_camara_det_mov
    device_class: motion
    # 0: No alarm
    # 1: Alarm triggered
    value_template: >-
            {%- if value != "0" %}
                ON
            {% else %}
                OFF
            {%- endif %}

  # Alarm status for foscam cam in living room
  - platform: mqtt
    state_topic: 'home/camera/salon/alarm'
    name: salon_camara_det_mov
    device_class: motion
    # 0: No alarm
    # 1: Alarm triggered
    value_template: >-
            {%- if value != "0" %}
                ON
            {% else %}
                OFF
            {%- endif %}

  # Alarm status for Linksys cam in caseta
  - platform: mqtt
    state_topic: 'home/camera/caseta/alarm'
    name: caseta_camara_det_mov
    device_class: motion
    # 0: No alarm
    # 1: Alarm triggered
    value_template: >-
            {%- if value != "0" %}
                ON
            {% else %}
                OFF
            {%- endif %}
  
  - platform: template
    sensors:
      despacho_sensor_movimiento_sabotaje:
        value_template: "{{ is_state('sensor.despacho_sensor_movimiento_burglar', '3') }}"
        device_class: vibration

sensor:
  - platform: template
    sensors:
      # Fibaro FGK10x door sensor battery level - porch door
      porche_sensor_puerta_bateria:
        value_template: '{% if states.zwave.porche_sensor_puerta %}{{ states.zwave.porche_sensor_puerta.attributes.battery_level }}{% else %}Desconocido{% endif %}'
        unit_of_measurement: '%'

      # Fibaro FGK10x door sensor battery level - porch blind
      porche_sensor_persiana_bateria:
        value_template: '{% if states.zwave.porche_sensor_persiana %}{{ states.zwave.porche_sensor_persiana.attributes.battery_level }}{% else %}Desconocido{% endif %}'
        unit_of_measurement: '%'

      # Fibaro FGK10x door sensor battery level - kitchen door
      coladuria_sensor_puerta_bateria:
        value_template: '{% if states.zwave.coladuria_sensor_puerta %}{{ states.zwave.coladuria_sensor_puerta.attributes.battery_level }}{% else %}Desconocido{% endif %}'
        unit_of_measurement: '%'

      # Fibaro FGMS-001 Motion sensor
      despacho_sensor_movimiento_bateria:
        value_template: '{% if states.zwave.despacho_sensor_movimiento %}{{ states.zwave.despacho_sensor_movimiento.attributes.battery_level }}{% else %}Desconocido{% endif %}'
        unit_of_measurement: '%'

google_assistant:
  entity_config:
    group.seguridad:
      name: Seguridad
      expose: true
      aliases:
        - Sensores alarma
        - Seguridad
        - Sensores
      room: General

automation:
  # Convert mkv videos to mp4 as soon as they are created to be able to send them through telegram
  - alias: 'Convert MKV to MP4'
    trigger:
      platform: event
      event_type: folder_watcher
      event_data:
        event_type: created
    condition:
      condition: and
      conditions:
        - condition: template
          value_template: '{{ "mkv" in trigger.event.data.file }}'
        - condition: template
          value_template: '{{ not(is_state("alarm_control_panel.home", "disarmed")) }}'
    action:
      # Delay execution to let the file to be fully loaded in the ftp
      - delay:
          seconds: 15
      - service: shell_command.mp4_convert
        data_template:
          file: '{{ trigger.event.data.path }}'

  # Trigger motion detected in camera for 30 seconds
  - alias: 'Motion detected in camera'
    trigger:
      platform: event
      event_type: folder_watcher
      event_data:
        event_type: created
    action:
      - service: mqtt.publish
        data_template:
          payload_template: 1
          retain: true
          topic: >- 
              {%- if "C1_00626E615161" in trigger.event.data.folder -%}home/camera/recibidor/alarm
              {%- elif "FI9853EP_00626E563E69" in trigger.event.data.folder -%}home/camera/piscina/alarm
              {%- elif "FI9900P_00626E6D21B2" in trigger.event.data.folder -%}home/camera/barbacoa/alarm
              {%- elif "WVC54CGA" in trigger.event.data.folder -%}home/camera/caseta/alarm
              {%- elif "puerta_principal" in trigger.event.data.folder -%}home/camera/entrada/alarm
              {%- elif "C1_00626E8305E1" in trigger.event.data.folder -%}home/camera/salon/alarm
              {%- else -%}desconocido{%-endif-%}
      - delay:
          seconds: 30
      - service: mqtt.publish
        data_template:
          payload: 0
          retain: true
          topic:  >- 
              {%- if "C1_00626E615161" in trigger.event.data.folder -%}home/camera/recibidor/alarm
              {%- elif "FI9853EP_00626E563E69" in trigger.event.data.folder -%}home/camera/piscina/alarm
              {%- elif "FI9900P_00626E6D21B2" in trigger.event.data.folder -%}home/camera/barbacoa/alarm
              {%- elif "WVC54CGA" in trigger.event.data.folder -%}home/camera/caseta/alarm
              {%- elif "puerta_principal" in trigger.event.data.folder -%}home/camera/entrada/alarm
              {%- elif "C1_00626E8305E1" in trigger.event.data.folder -%}home/camera/salon/alarm
              {%- else -%}desconocido{%-endif-%}
      - service: logbook.log
        data_template:
          name: >-
              {%- if "C1_00626E615161" in trigger.event.data.folder -%}Recibidor
              {%- elif "FI9853EP_00626E563E69" in trigger.event.data.folder -%}Piscina
              {%- elif "FI9900P_00626E6D21B2" in trigger.event.data.folder -%}Barbacoa
              {%- elif "WVC54CGA" in trigger.event.data.folder -%}Caseta
              {%- elif "puerta_principal" in trigger.event.data.folder -%}Entrada principal
              {%- elif "C1_00626E8305E1" in trigger.event.data.folder -%}Salón
              {%- else -%}desconocido{%-endif-%}
          message: 'Movimiento detectado'
          entity_id: >-
              {%- if "C1_00626E615161" in trigger.event.data.folder -%}camera.recibidor
              {%- elif "FI9853EP_00626E563E69" in trigger.event.data.folder -%}camera.piscina
              {%- elif "FI9900P_00626E6D21B2" in trigger.event.data.folder -%}camera.barbacoa
              {%- elif "WVC54CGA" in trigger.event.data.folder -%}camera.caseta
              {%- elif "puerta_principal" in trigger.event.data.folder -%}camera.entrada_principal
              {%- elif "C1_00626E8305E1" in trigger.event.data.folder -%}camera.salon
              {%- else -%}desconocido{%-endif-%}
          domain: camera

shell_command:
  mp4_convert: sudo ffmpeg -i {{file}} -c copy {{file[1:file.find(".mkv")]}}.mp4